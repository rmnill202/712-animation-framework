{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es6.object.keys.js","webpack:///./node_modules/core-js/modules/_object-sap.js","webpack:///./node_modules/core-js/modules/es6.function.name.js","webpack:///./src/views/Update_3.vue?8325","webpack:///./node_modules/core-js/modules/es6.regexp.replace.js","webpack:///./src/views/Update_3.vue?844b","webpack:///./src/components/3_mocap/MocapFramework.vue?2ee6","webpack:///./src/components/3_mocap/BvhParser.js","webpack:///./src/components/3_mocap/MocapAnimation.js","webpack:///src/components/3_mocap/MocapFramework.vue","webpack:///./src/components/3_mocap/MocapFramework.vue?a686","webpack:///./src/components/3_mocap/MocapFramework.vue","webpack:///src/views/Update_3.vue","webpack:///./src/views/Update_3.vue?3764","webpack:///./src/views/Update_3.vue"],"names":["toObject","$keys","it","$export","core","fails","module","exports","KEY","exec","fn","Object","exp","S","F","dP","f","FProto","Function","prototype","nameRE","NAME","configurable","get","this","match","e","anObject","toLength","toInteger","advanceStringIndex","regExpExec","max","Math","min","floor","SUBSTITUTION_SYMBOLS","SUBSTITUTION_SYMBOLS_NO_NAMED","maybeToString","undefined","String","defined","REPLACE","$replace","maybeCallNative","searchValue","replaceValue","O","call","regexp","res","done","value","rx","functionalReplace","global","fullUnicode","unicode","lastIndex","results","result","push","matchStr","accumulatedResult","nextSourcePosition","i","length","matched","position","index","captures","j","namedCaptures","groups","replacerArgs","concat","replacement","apply","getSubstitution","slice","str","tailPos","m","symbols","ch","capture","charAt","n","render","_vm","_h","$createElement","_c","_self","_v","_m","staticRenderFns","staticStyle","staticClass","attrs","on","$event","togglePausePlay","_s","isPaused","restartAnimation","animFileChosen","directives","name","rawName","expression","domProps","target","composing","speed_rate","parseJoint","parent","motion_index","joints","line_index","lines","trim","replace","offset_index","channels_index","next_index","joint_offset","getOffset","joint_channels","getChannels","keys","offset","channels","my_index","next_line","input_index","endOfJoints","string","split","parseFloat","base_index","splt","qty","parseInt","channels_obj","parseHeader","fileString","parseBody","frame_time","frames","start","isEnd","data","precomputeFrameData","map","x","joint_data","Array","parent_pos","parent_rtn","root_pos","THREE","add","root_rot","getRotationQuaternion","PI","rotation","j_future_rotation","clone","multiply","origin_position","rotation_around_origin","offset_position","applyQuaternion","ry","rz","qx","setFromAxisAngle","qy","qz","normalize","parseBVH","skeleton","MocapAnimation","isPlaying","hasEnded","timeline","frameIndex","updateMeshes","dt","playing","currentFrame","frame","mesh","mesh_joint","frame_position","y","z","setRotationFromQuaternion","mesh_segment","parent_mesh","geometry","vertices","verticesNeedUpdate","frame_1","frame_2","u","lerp_find_u","quat_1","quat_2","xa","ya","za","thetaRad","slerp","dot","set","w","theta","acos","sin_theta","sin","left","right","q1v","toArray","multiplyScalar","q2v","lerp","camera","scene","renderer","sceneObjects","threeClock","originTime","lastFrameTime","endTime","mocap","bodyMeshes","methods","init_threejs","rotateY","rotateX","setupScene","setSize","threeJsDiv","clientWidth","clientHeight","performance","now","appendChild","domElement","simpleMesh","updateScene","getFrame","animationLoop","requestAnimationFrame","newTime","getDelta","file_reader","readAsText","anim_file","onload","parseBvhFile","joint_mesh","line_geom","line_mesh","restart","play","pause","mounted","component","components","MocapFramework"],"mappings":"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","file":"js/update_3.52c51d71.js","sourcesContent":["// 19.1.2.14 Object.keys(O)\nvar toObject = require('./_to-object');\nvar $keys = require('./_object-keys');\n\nrequire('./_object-sap')('keys', function () {\n  return function keys(it) {\n    return $keys(toObject(it));\n  };\n});\n","// most Object methods by ES6 should accept primitives\nvar $export = require('./_export');\nvar core = require('./_core');\nvar fails = require('./_fails');\nmodule.exports = function (KEY, exec) {\n  var fn = (core.Object || {})[KEY] || Object[KEY];\n  var exp = {};\n  exp[KEY] = exec(fn);\n  $export($export.S + $export.F * fails(function () { fn(1); }), 'Object', exp);\n};\n","var dP = require('./_object-dp').f;\nvar FProto = Function.prototype;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// 19.2.4.2 name\nNAME in FProto || require('./_descriptors') && dP(FProto, NAME, {\n  configurable: true,\n  get: function () {\n    try {\n      return ('' + this).match(nameRE)[1];\n    } catch (e) {\n      return '';\n    }\n  }\n});\n","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Update_3.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Update_3.vue?vue&type=style&index=0&lang=css&\"","'use strict';\n\nvar anObject = require('./_an-object');\nvar toObject = require('./_to-object');\nvar toLength = require('./_to-length');\nvar toInteger = require('./_to-integer');\nvar advanceStringIndex = require('./_advance-string-index');\nvar regExpExec = require('./_regexp-exec-abstract');\nvar max = Math.max;\nvar min = Math.min;\nvar floor = Math.floor;\nvar SUBSTITUTION_SYMBOLS = /\\$([$&`']|\\d\\d?|<[^>]*>)/g;\nvar SUBSTITUTION_SYMBOLS_NO_NAMED = /\\$([$&`']|\\d\\d?)/g;\n\nvar maybeToString = function (it) {\n  return it === undefined ? it : String(it);\n};\n\n// @@replace logic\nrequire('./_fix-re-wks')('replace', 2, function (defined, REPLACE, $replace, maybeCallNative) {\n  return [\n    // `String.prototype.replace` method\n    // https://tc39.github.io/ecma262/#sec-string.prototype.replace\n    function replace(searchValue, replaceValue) {\n      var O = defined(this);\n      var fn = searchValue == undefined ? undefined : searchValue[REPLACE];\n      return fn !== undefined\n        ? fn.call(searchValue, O, replaceValue)\n        : $replace.call(String(O), searchValue, replaceValue);\n    },\n    // `RegExp.prototype[@@replace]` method\n    // https://tc39.github.io/ecma262/#sec-regexp.prototype-@@replace\n    function (regexp, replaceValue) {\n      var res = maybeCallNative($replace, regexp, this, replaceValue);\n      if (res.done) return res.value;\n\n      var rx = anObject(regexp);\n      var S = String(this);\n      var functionalReplace = typeof replaceValue === 'function';\n      if (!functionalReplace) replaceValue = String(replaceValue);\n      var global = rx.global;\n      if (global) {\n        var fullUnicode = rx.unicode;\n        rx.lastIndex = 0;\n      }\n      var results = [];\n      while (true) {\n        var result = regExpExec(rx, S);\n        if (result === null) break;\n        results.push(result);\n        if (!global) break;\n        var matchStr = String(result[0]);\n        if (matchStr === '') rx.lastIndex = advanceStringIndex(S, toLength(rx.lastIndex), fullUnicode);\n      }\n      var accumulatedResult = '';\n      var nextSourcePosition = 0;\n      for (var i = 0; i < results.length; i++) {\n        result = results[i];\n        var matched = String(result[0]);\n        var position = max(min(toInteger(result.index), S.length), 0);\n        var captures = [];\n        // NOTE: This is equivalent to\n        //   captures = result.slice(1).map(maybeToString)\n        // but for some reason `nativeSlice.call(result, 1, result.length)` (called in\n        // the slice polyfill when slicing native arrays) \"doesn't work\" in safari 9 and\n        // causes a crash (https://pastebin.com/N21QzeQA) when trying to debug it.\n        for (var j = 1; j < result.length; j++) captures.push(maybeToString(result[j]));\n        var namedCaptures = result.groups;\n        if (functionalReplace) {\n          var replacerArgs = [matched].concat(captures, position, S);\n          if (namedCaptures !== undefined) replacerArgs.push(namedCaptures);\n          var replacement = String(replaceValue.apply(undefined, replacerArgs));\n        } else {\n          replacement = getSubstitution(matched, S, position, captures, namedCaptures, replaceValue);\n        }\n        if (position >= nextSourcePosition) {\n          accumulatedResult += S.slice(nextSourcePosition, position) + replacement;\n          nextSourcePosition = position + matched.length;\n        }\n      }\n      return accumulatedResult + S.slice(nextSourcePosition);\n    }\n  ];\n\n    // https://tc39.github.io/ecma262/#sec-getsubstitution\n  function getSubstitution(matched, str, position, captures, namedCaptures, replacement) {\n    var tailPos = position + matched.length;\n    var m = captures.length;\n    var symbols = SUBSTITUTION_SYMBOLS_NO_NAMED;\n    if (namedCaptures !== undefined) {\n      namedCaptures = toObject(namedCaptures);\n      symbols = SUBSTITUTION_SYMBOLS;\n    }\n    return $replace.call(replacement, symbols, function (match, ch) {\n      var capture;\n      switch (ch.charAt(0)) {\n        case '$': return '$';\n        case '&': return matched;\n        case '`': return str.slice(0, position);\n        case \"'\": return str.slice(tailPos);\n        case '<':\n          capture = namedCaptures[ch.slice(1, -1)];\n          break;\n        default: // \\d\\d?\n          var n = +ch;\n          if (n === 0) return match;\n          if (n > m) {\n            var f = floor(n / 10);\n            if (f === 0) return match;\n            if (f <= m) return captures[f - 1] === undefined ? ch.charAt(1) : captures[f - 1] + ch.charAt(1);\n            return match;\n          }\n          capture = captures[n - 1];\n      }\n      return capture === undefined ? '' : capture;\n    });\n  }\n});\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('h1',[_vm._v(\"Assignment 3 - Motion Capture\")]),_c('h2',[_vm._v(\"Results\")]),_c('MocapFramework'),_c('h2',[_vm._v(\"Summary\")]),_vm._m(0)],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"text-align\":\"left\"}},[_c('div',{staticClass:\"update-text\"},[_vm._v(\" \\n      Chaining rotations properly is a pain. \\n    \")])])}]\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticStyle:{\"width\":\"1100px\",\"height\":\"800px\",\"margin\":\"auto\"},attrs:{\"id\":\"three-js-div\"}}),_c('button',{on:{\"click\":function($event){return _vm.togglePausePlay()}}},[_vm._v(_vm._s(_vm.isPaused ? \"Play\" : \"Pause\"))]),_c('button',{on:{\"click\":function($event){return _vm.restartAnimation()}}},[_vm._v(\"Restart\")]),_c('input',{attrs:{\"type\":\"file\"},on:{\"change\":_vm.animFileChosen}}),_c('div',[_vm._v(\"\\n    Speed rate: (1.0 being normal) \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.speed_rate),expression:\"speed_rate\"}],domProps:{\"value\":(_vm.speed_rate)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.speed_rate=$event.target.value}}})])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import * as THREE from 'three';\r\n\r\n// Returns a tuple of the next line in the input to process, and absolute motion index\r\n// { input_index: , motion_index: }\r\nlet parseJoint = (parent, motion_index, joints, line_index, lines) => {\r\n  \r\n  // Assume we're at a joint position, get the name of the joint\r\n  let name = parent == -1 ? lines[line_index].trim().replace(\"ROOT \", \"\") : lines[line_index].trim().replace(\"JOINT \", \"\");\r\n\r\n  // Get the next indices to consider\r\n  let offset_index = line_index + 2, channels_index = line_index + 3, next_index = line_index + 4;\r\n\r\n  // Parse the offset and channel\r\n  let joint_offset = getOffset(lines[offset_index].trim());\r\n  let joint_channels = getChannels(lines[channels_index].trim(), motion_index);\r\n\r\n  // The next joint to be processed must have the proper motion index\r\n  motion_index += Object.keys(joint_channels).length;\r\n\r\n  // We now have enough info to add this node to the list of joints, hooray!\r\n  joints.push({\r\n    name: name,\r\n    parent: parent,\r\n    offset: joint_offset,\r\n    channels: joint_channels\r\n  });\r\n  \r\n  let my_index = joints.length - 1;\r\n\r\n  // We have either (1..n JOINTs) or (1 Endsite). If its just an endsite,\r\n  //   then we can add it right here.\r\n  let next_line = lines[next_index].trim();\r\n\r\n  if(next_line == \"End Site\") {\r\n\r\n    joints.push({\r\n      name: \"End Site\",\r\n      parent: my_index,\r\n      offset: getOffset(lines[next_index + 2].trim()),\r\n      channels: { }\r\n    });\r\n\r\n    // Now, return the next line to process\r\n    return {input_index: next_index + 5, motion_index: motion_index};\r\n  } \r\n  else {\r\n\r\n    let endOfJoints = false;\r\n    while(!endOfJoints) {\r\n      // Try to parse the next joint\r\n      let result = parseJoint(my_index, motion_index, joints, next_index, lines);\r\n\r\n      motion_index = result.motion_index;\r\n      next_index = result.input_index;\r\n\r\n      // We're given the index of the next joint to process. This will either be\r\n      // a closing curly brace, or a joint. If we see joint, continue. Otherwise,\r\n      // we're done here!\r\n      if(lines[next_index].trim() == \"}\") {\r\n        next_index += 1;\r\n        endOfJoints = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    return {input_index: next_index, motion_index: motion_index};\r\n  }\r\n};\r\n\r\n// Gather the XYZ offset, return as a list\r\nlet getOffset = (string) => {\r\n  // console.log(string);\r\n  let offset = string.split(\"\\t\");\r\n  return [parseFloat(offset[1]), parseFloat(offset[2]), parseFloat(offset[3])];\r\n};\r\n\r\n// Map the channels to their absolute index in a line of motion data\r\nlet getChannels = (string, base_index) => {\r\n  let splt = string.split(\"\\t\");\r\n  let qty = parseInt(splt[1]);\r\n\r\n  let channels_obj = { };\r\n  for(let i = 0; i < qty; i++) {\r\n    channels_obj[splt[i + 2]] = i + base_index;\r\n  }\r\n\r\n  return channels_obj;\r\n}\r\n\r\nlet parseHeader = (fileString) => {\r\n  // Split into lines\r\n  let lines = fileString.split(\"\\n\");\r\n\r\n  // Parse this thing recursively\r\n  let joints = [];\r\n\r\n  parseJoint(-1, 0, joints, 1, lines);\r\n\r\n  return joints;\r\n};\r\n\r\nlet parseBody = (fileString, joints) => {\r\n  // Split into lines\r\n  let lines = fileString.split(\"\\n\");\r\n\r\n  // Get the time per frame\r\n  let frame_time = parseFloat(lines[2].split(\":\")[1]);\r\n\r\n  let frames = [];\r\n  for(let i = 3; i < lines.length - 1; i++) {\r\n    if(lines[i].trim() != \"\" && lines[i].trim() != \"\\n\") {\r\n      frames.push({\r\n        start: (i - 3) * frame_time,\r\n        isEnd: false,\r\n        // data: lines[i].split(\"\\t\").map(x => parseFloat(x)),\r\n        data: precomputeFrameData(lines[i].split(\"\\t\").map(x => parseFloat(x)), joints)\r\n      });\r\n    }\r\n  }\r\n\r\n  frames[frames.length - 1].isEnd = true;\r\n\r\n  return frames;\r\n};\r\n\r\nlet precomputeFrameData = (data, joints) => {\r\n  let joint_data = new Array(joints.length);\r\n\r\n  // Go through the hierarchy and compute the position of each joint. Track parent positions/rotations\r\n  let parent_pos = new Array(joints.length);\r\n  let parent_rtn = new Array(joints.length);\r\n\r\n\r\n  //// Edge case - Root node\r\n  // Compute the root's position, based on its offset and X/Y/Z channels\r\n  let root_pos = new THREE.Vector3(...joints[0].offset);\r\n  root_pos.add(new THREE.Vector3(data[joints[0].channels['Xposition']], \r\n                                 data[joints[0].channels['Yposition']], \r\n                                 data[joints[0].channels['Zposition']]));\r\n\r\n  parent_pos[0] = root_pos;\r\n\r\n  // Also track the root node's rotation, which flips the entire object around\r\n  let root_rot = getRotationQuaternion((data[joints[0].channels['Xrotation']] * Math.PI) / 180.0,\r\n                                       (data[joints[0].channels['Yrotation']] * Math.PI) / 180.0,\r\n                                       (data[joints[0].channels['Zrotation']] * Math.PI) / 180.0 );\r\n  parent_rtn[0] = root_rot;\r\n\r\n  // Store that in the final joint data\r\n  joint_data[0] = {\r\n    position: root_pos,\r\n    rotation: root_rot,\r\n  };\r\n\r\n\r\n  // Go through the remaining nodes\r\n  for(let i = 1; i < joints.length; i++) {\r\n    // Get info from the joint\r\n    let j = joints[i], is_end = j.name == \"End Site\";\r\n      \r\n    // This rotation information will be useful for later joints\r\n    // let j_future_rotation = getRotationQuaternion((data[joints[i].channels['Xrotation']] * Math.PI) / 180.0,\r\n    //                                               (data[joints[i].channels['Yrotation']] * Math.PI) / 180.0,\r\n    //                                               (data[joints[i].channels['Zrotation']] * Math.PI) / 180.0 );\r\n    // j_future_rotation.multiply(parent_rtn[j.parent]);\r\n    let j_future_rotation = parent_rtn[j.parent].clone();\r\n    j_future_rotation.multiply(getRotationQuaternion((data[joints[i].channels['Xrotation']] * Math.PI) / 180.0,\r\n                                                  (data[joints[i].channels['Yrotation']] * Math.PI) / 180.0,\r\n                                                  (data[joints[i].channels['Zrotation']] * Math.PI) / 180.0 ));\r\n    parent_rtn[i] = j_future_rotation;\r\n\r\n    // The position of this node is just the offset from the parent node given some rotation. That\r\n    //   rotation comes from the parent node itself. So we'll use both to determine the absolute\r\n    //   world space position of this node!\r\n    let origin_position = parent_pos[j.parent].clone(), rotation_around_origin = parent_rtn[j.parent],\r\n        offset_position = new THREE.Vector3(...j.offset);\r\n\r\n\r\n\r\n    // A\r\n    // Rotate the offset, and add it onto the origin position\r\n    // offset_position.sub(origin_position);\r\n    offset_position.applyQuaternion(rotation_around_origin);\r\n    offset_position.add(origin_position);\r\n\r\n\r\n    // B\r\n    // Ensure the new point is centered on the origin point. \r\n\r\n    // Store that final position\r\n    parent_pos[i] = offset_position;\r\n\r\n    // And pass along this object's position/rotation to the end data\r\n    joint_data[i] = {\r\n      position: offset_position,\r\n      rotation: rotation_around_origin,\r\n    };\r\n\r\n  }\r\n  \r\n\r\n  return joint_data;\r\n};\r\n\r\nlet getRotationQuaternion = (rx, ry, rz) => {\r\n  // Apply in Z > X > Y order\r\n  let qx = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1, 0, 0), rx);\r\n  let qy = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), ry);\r\n  let qz = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 0, 1), rz);\r\n\r\n  qz.multiply(qx).multiply(qy);\r\n  return qz.normalize();\r\n  // qy.multiply(qx).multiply(qz);\r\n  // return qy;\r\n  // qx.multiply(qy).multiply(qz);\r\n  // return qx;\r\n};\r\n\r\nexport default {\r\n  parseBVH(fileString) {\r\n    // Parse the header into a skeleton\r\n    let skeleton = parseHeader(fileString.split(\"MOTION\")[0]);\r\n\r\n    // Then parse the body into frames\r\n    let frames = parseBody(fileString.split(\"MOTION\")[1], skeleton);\r\n\r\n    // console.log(skeleton);\r\n    // console.log(frames);\r\n    \r\n\r\n    // Return as a tuple\r\n    return {\r\n      skeleton: skeleton,\r\n      frames: frames,\r\n    };\r\n  }\r\n};","import * as THREE from 'three';\r\n\r\nexport default class MocapAnimation {\r\n  constructor(joints, frames) {\r\n    \r\n    // Track the input\r\n    this.joints = joints;\r\n    this.frames = frames;\r\n\r\n    // Have an initial state: we're not playing, and our timeline is at 0 seconds\r\n    this.isPlaying = false;\r\n    this.hasEnded = false;\r\n    this.timeline = 0.0;\r\n    this.frameIndex = 0;\r\n\r\n    // Update the meshes to their default positions/orientations\r\n    this.updateMeshes(this.frames[0]);\r\n  }\r\n\r\n  playing() {\r\n    return this.isPlaying && !this.hasEnded;\r\n  }\r\n\r\n  restart() {\r\n    this.isPlaying = false;\r\n    this.timeline = 0.0;\r\n    this.frameIndex = 0;\r\n    this.hasEnded = false;\r\n    this.updateMeshes(this.frames[0]);\r\n  }\r\n\r\n  play() {\r\n    if(!this.hasEnded) {\r\n      this.isPlaying = true;\r\n    }\r\n  }\r\n\r\n  pause() {\r\n    this.isPlaying = false;\r\n  }\r\n\r\n  // Given the time in milliseconds, update the mocap figure\r\n  getFrame(dt) {\r\n    if(this.playing()) {\r\n      // Get the new time\r\n      let oldTime = this.timeline;\r\n      this.timeline += dt;\r\n\r\n      // Determine the current frame, and calculate the new position/rotation\r\n      let currentFrame = this.frames[this.frameIndex];\r\n      while( !currentFrame.isEnd && (this.timeline >= this.frames[this.frameIndex + 1].start) ) {\r\n        currentFrame = this.frames[++this.frameIndex];\r\n      }\r\n\r\n      this.updateMeshes(currentFrame);\r\n\r\n      // Determine if the animation is complete\r\n      if(currentFrame.isEnd) {\r\n        // If complete, this.isPlaying = false and this.hasEnded = true\r\n        this.isPlaying = false;\r\n        this.hasEnded = true;\r\n        this.timeline = currentFrame.start;\r\n      }\r\n\r\n    } \r\n  }\r\n\r\n  // Calculate the rotation/position of the object at some frame and time\r\n  updateMeshes(frame) {\r\n    // Go through each joint and apply the matrix from the frame\r\n    for(let i = 0; i < this.joints.length; i++) {\r\n      let j = this.joints[i];\r\n      let mesh = this.joints[i].mesh_joint;\r\n\r\n      // Frame data has a position and rotation\r\n      let frame_position = frame.data[i].position;\r\n      mesh.position.x = frame_position.x;\r\n      mesh.position.y = frame_position.y;\r\n      mesh.position.z = frame_position.z;\r\n      mesh.setRotationFromQuaternion(frame.data[i].rotation);\r\n\r\n\r\n      if(j.mesh_segment) {\r\n        let parent_mesh = this.joints[j.parent].mesh_joint;\r\n        j.mesh_segment.geometry.vertices[0].x = mesh.position.x;\r\n        j.mesh_segment.geometry.vertices[0].y = mesh.position.y;\r\n        j.mesh_segment.geometry.vertices[0].z = mesh.position.z;\r\n        j.mesh_segment.geometry.vertices[1].x = parent_mesh.position.x;\r\n        j.mesh_segment.geometry.vertices[1].y = parent_mesh.position.y;\r\n        j.mesh_segment.geometry.vertices[1].z = parent_mesh.position.z;\r\n        j.mesh_segment.geometry.verticesNeedUpdate = true;\r\n      }\r\n      \r\n    }\r\n  }\r\n\r\n  alt_slerp(frame_1, frame_2) {\r\n    let u = this.lerp_find_u(frame_1.start, frame_2.start, this.timeline);\r\n    let quat_1 = new THREE.Quaternion(), quat_2 = new THREE.Quaternion();\r\n    quat_1.setFromAxisAngle( new THREE.Vector3(frame_1.xa, frame_1.ya, frame_1.za).normalize(), frame_1.thetaRad );\r\n    quat_2.setFromAxisAngle( new THREE.Vector3(frame_2.xa, frame_2.ya, frame_2.za).normalize(), frame_2.thetaRad );\r\n\r\n    return quat_1.slerp(quat_2, u);\r\n  }\r\n\r\n  rotation_slerp(frame_1, frame_2) {\r\n    // Find the amount by which to rotate the angle\r\n    let u = this.lerp_find_u(frame_1.start, frame_2.start, this.timeline);\r\n\r\n    // Set up our quaternions\r\n    let quat_1 = new THREE.Quaternion(), quat_2 = new THREE.Quaternion();\r\n    quat_1.setFromAxisAngle( new THREE.Vector3(frame_1.xa, frame_1.ya, frame_1.za).normalize(), frame_1.thetaRad );\r\n    quat_2.setFromAxisAngle( new THREE.Vector3(frame_2.xa, frame_2.ya, frame_2.za).normalize(), frame_2.thetaRad );\r\n    quat_1.normalize();\r\n    quat_2.normalize();\r\n\r\n    // Take the dot product to find theta between the quaternions. Reverse if necessary\r\n    let dot = quat_1.dot(quat_2);\r\n    if(dot <= 0.0) { \r\n      quat_1.set(-quat_1.x, -quat_1.y, -quat_1.z, -quat_1.w);\r\n      dot = -dot;\r\n    }\r\n\r\n    // Equation: q1 * ( sin(1-u * theta) / sin(theta))     +      q2 * (sin(u * theta) / sin(theta))\r\n    \r\n    // Find theta\r\n    let theta = Math.acos(dot);\r\n    let sin_theta = Math.sin(theta);\r\n\r\n    // Calculate the left and right sides without the quaternions\r\n    let left = Math.sin((1.0 - u) * theta) / sin_theta;\r\n    let right = Math.sin(u * theta) / sin_theta;\r\n\r\n    // Combine with quaternions, and return\r\n    let q1v = new THREE.Vector4( ...quat_1.toArray());\r\n    q1v.multiplyScalar(left);\r\n    let q2v = new THREE.Vector4( ...quat_2.toArray());\r\n    q2v.multiplyScalar(right);\r\n    return new THREE.Quaternion( ...(q1v.add(q2v)).toArray() );\r\n  }\r\n\r\n  translation_lerp(frame_1, frame_2) {\r\n    // Interpolate x/y/z linearly\r\n    let u = this.lerp_find_u(frame_1.start, frame_2.start, this.timeline);\r\n\r\n    // console.log(`${u} from ${frame_1.start}, ${frame_2.start}, ${this.timeline}`);\r\n    return { x: this.lerp(frame_1.x, frame_2.x, u), y: this.lerp(frame_1.y, frame_2.y, u), z: this.lerp(frame_1.z, frame_2.z, u) }\r\n  }\r\n\r\n  lerp(x, y, u) {\r\n    return x + (u * (y - x));\r\n  }\r\n\r\n  lerp_find_u(x, y, z) {\r\n    return (z - x) / (y - x);\r\n  }\r\n}\r\n","<template>\r\n  <div>\r\n    <div id=\"three-js-div\" style=\"width: 1100px; height: 800px; margin: auto;\"></div>\r\n    <button @click=\"togglePausePlay()\">{{isPaused ? \"Play\" : \"Pause\"}}</button>\r\n    <button @click=\"restartAnimation()\">Restart</button>\r\n    <input type=\"file\" @change=\"animFileChosen\"/>\r\n    <div>\r\n      Speed rate: (1.0 being normal) <input v-model=\"speed_rate\"/>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as THREE from 'three';\r\nimport SceneEntity from '../SceneEntity.js';\r\nimport BvhParser from './BvhParser.js';\r\nimport MocapAnimation from './MocapAnimation.js';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      // Three.js Components\r\n      camera: null,\r\n      scene: null,\r\n      renderer: null,\r\n      mesh: null,\r\n      sceneObjects: [],\r\n      speed_rate: 1.0,\r\n\r\n      // UI Stuff\r\n      \r\n\r\n      // Timeline details\r\n      threeClock: null,\r\n      originTime: 0,\r\n      lastFrameTime: 0,   // Milliseconds\r\n      endTime: 20 * 1000, // Milliseconds\r\n      isPaused: true,\r\n      mocap: null,\r\n      \r\n      // Meshes for the body\r\n      bodyMeshes: [],\r\n\r\n      \r\n    };\r\n  },\r\n  methods: {\r\n    init_threejs() {\r\n      // Get a reference to the DOM that the renderer will be added to\r\n      const threeJsDiv = document.getElementById(\"three-js-div\");\r\n\r\n      // Setup the camera and scene\r\n      this.scene = new THREE.Scene();\r\n\r\n      // this.camera = new THREE.PerspectiveCamera(75, threeJsDiv.clientWidth / threeJsDiv.clientHeight, 0.01, 10);\r\n      this.camera = new THREE.PerspectiveCamera(75, threeJsDiv.clientWidth / threeJsDiv.clientHeight, 0.01, 10000);\r\n      this.camera.position.z = -310;\r\n      this.camera.position.y = 150;\r\n      this.camera.position.x = -270;\r\n      this.camera.rotateY(Math.PI);\r\n      this.camera.rotateY(0.9);\r\n      this.camera.rotateX(-0.20);\r\n\r\n      // Setup the scene\r\n      this.setupScene();\r\n\r\n      // Set up the renderer\r\n      this.renderer = new THREE.WebGLRenderer({antialias: true});\r\n      this.renderer.setSize(threeJsDiv.clientWidth, threeJsDiv.clientHeight);\r\n\r\n      // Initialize the timeline\r\n      // this.originTime = performance.now();\r\n      // this.lastFrameTime = this.originTime;\r\n      this.originTime = performance.now();\r\n      this.lastFrameTime = this.originTime;\r\n      this.threeClock = new THREE.Clock();\r\n\r\n      // Finally, add the renderer to the DOM\r\n      threeJsDiv.appendChild(this.renderer.domElement);\r\n    },\r\n    setupScene() {\r\n      // Create a simple floor to add to our scene!\r\n      let geometry = new THREE.BoxGeometry(3000, 1, 3000);\r\n      let material = new THREE.MeshNormalMaterial();\r\n      let simpleMesh = new THREE.Mesh(geometry, material);\r\n      simpleMesh.position.y = -100;\r\n      \r\n      this.scene.add(simpleMesh);\r\n      // this.scene.add(new THREE.GridHelper( 400, 10 ));\r\n    },\r\n    updateScene(dt) {\r\n      // Update... stuff?\r\n      if(this.mocap) {\r\n        this.mocap.getFrame(dt * this.speed_rate);\r\n      }\r\n    },\r\n    animationLoop(newTime) {\r\n      // Hook for threejs to call this method again\r\n      requestAnimationFrame(this.animationLoop);\r\n\r\n      // Update the scene\r\n      let dt = (newTime - this.originTime);\r\n      this.originTime = newTime;\r\n      this.updateScene(this.threeClock.getDelta());\r\n\r\n      // Finally, render the updated scene\r\n      this.renderer.render(this.scene, this.camera);\r\n    },\r\n    animFileChosen(evnt) {\r\n      let anim_file = evnt.target.files[0];\r\n      let file_reader = new FileReader();\r\n\r\n      file_reader.readAsText(anim_file);\r\n      file_reader.onload = result => this.parseBvhFile(result.target.result);\r\n        \r\n    },\r\n    parseBvhFile(fileString) {\r\n      // console.log(\"Attempting to parse...\");\r\n      let parsed = BvhParser.parseBVH(fileString);\r\n\r\n      // Cleanup the existing scene\r\n      for(let m of this.bodyMeshes) {\r\n        this.scene.remove(m);\r\n        m.geometry.dispose();\r\n        m.material.dispose();\r\n      }\r\n      this.bodyMeshes = [];\r\n\r\n      // Now that we've parsed the BVH, we're going to prep meshes that'll be updated by the animation\r\n      let joints = parsed.skeleton;\r\n\r\n      for(let i = 0; i < joints.length; i++) {\r\n        // Add a joint mesh (Cube)\r\n        let joint_mesh = new THREE.Mesh(new THREE.BoxGeometry(5,5,5), new THREE.MeshNormalMaterial());\r\n        joints[i].mesh_joint = joint_mesh;\r\n        this.bodyMeshes.push(joint_mesh);\r\n\r\n        // If this joint connects to a parent, add in a Line as well\r\n        if(joints[i].parent != -1) {\r\n          let line_geom = new THREE.Geometry();\r\n          line_geom.vertices.push( \r\n            new THREE.Vector3(0,0,0),\r\n            new THREE.Vector3(1,1,1)\r\n          );\r\n          let line_mesh = new THREE.Line(line_geom, new THREE.LineBasicMaterial({ color: 0x0000ff }));\r\n          joints[i].mesh_segment = line_mesh;\r\n          this.bodyMeshes.push(line_mesh);\r\n        }\r\n      }\r\n\r\n      // Create the animation, initializing the meshes to their proper positions/orientations\r\n      this.mocap = new MocapAnimation(joints, parsed.frames);\r\n\r\n      // Add the meshes into the scene now!\r\n      for(let mesh of this.bodyMeshes) {\r\n        // console.log(mesh.geometry);\r\n        this.scene.add(mesh);\r\n      }\r\n\r\n    },\r\n    restartAnimation() {\r\n      if(this.mocap) {\r\n        this.mocap.restart();\r\n        this.isPaused = true;\r\n      }\r\n    },\r\n    togglePausePlay() {\r\n      if(this.mocap) {\r\n        if(this.isPaused) {\r\n          this.mocap.play();\r\n          this.isPaused = !this.mocap.playing();\r\n        } else {\r\n          this.mocap.pause();\r\n          this.isPaused = true;\r\n        }\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.init_threejs();\r\n    this.animationLoop();\r\n  }\r\n};\r\n</script>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MocapFramework.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MocapFramework.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MocapFramework.vue?vue&type=template&id=130c287c&\"\nimport script from \"./MocapFramework.vue?vue&type=script&lang=js&\"\nexport * from \"./MocapFramework.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <div>\r\n    <h1>Assignment 3 - Motion Capture</h1>\r\n    <h2>Results</h2>\r\n    <!-- <DynamicFramework/> -->\r\n    <!-- <BilliardsFramework/> -->\r\n    <MocapFramework/>\r\n\r\n    <h2>Summary</h2>\r\n    <div style=\"text-align: left;\">\r\n      <div class=\"update-text\"> \r\n        Chaining rotations properly is a pain. \r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// import DynamicFramework from '../components/DynamicFramework';\r\n// import BilliardsFramework from '../components/2_billiards/BilliardsFramework';\r\nimport MocapFramework from '../components/3_mocap/MocapFramework';\r\n\r\nexport default {\r\n  components: {\r\n    MocapFramework\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.update-text {\r\n  max-width: 1000px;\r\n  margin: 10px auto;\r\n}\r\n\r\n@media only screen and (max-width: 950px) {\r\n  .update-text {\r\n    max-width: 100%;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Update_3.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Update_3.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Update_3.vue?vue&type=template&id=fa699e1a&\"\nimport script from \"./Update_3.vue?vue&type=script&lang=js&\"\nexport * from \"./Update_3.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Update_3.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}